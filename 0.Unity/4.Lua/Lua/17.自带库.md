[toc]

# Lua 自带库详解

## 一、时间处理

### 1. 获取当前时间戳

```lua
print(os.time())  -- 输出: 当前时间戳（秒级）
```

> **规则**：
- 返回自 **1970 年 1 月 1 日 00:00:00 UTC** 的秒数（Unix 时间戳）。
- 适用于跨平台时间计算。

---

### 2. 自定义时间戳

```lua
print(os.time({year = 2025, month = 8, day = 14}))
```

> **规则**：
- `os.time({year, month, day, hour, min, sec})` 可构建任意日期的时间戳。
- 默认忽略未指定的字段（如小时、分钟等），默认值为 0。

---

### 3. 解析时间戳为表结构

```lua
local time = os.date("*t")
for i, v in pairs(time) do
    print(i, v)
end
```

> **关键特性**：
- `os.date("*t", timestamp)` 返回一个包含时间字段的表。
- 默认使用当前时间（不传 `timestamp` 时）。

---

## 二、数学运算

### 1. 基础数学函数

```lua
print(math.abs(-11))        -- 输出: 11（绝对值）
print(math.deg(math.pi))    -- 输出: 180（弧度转角度）
print(math.cos(math.pi))    -- 输出: -1（cos(π)）
```

> **规则**：
- `math.cos` 等三角函数接收**弧度**作为参数。
- `math.deg(radians)` 将弧度转换为角度，`math.rad(degrees)` 做反向转换。

---

### 2. 取整函数

```lua
print(math.floor(2.6))  -- 输出: 2（向下取整）
print(math.ceil(5.2))   -- 输出: 6（向上取整）
```

> **区别**：
- `math.floor(x)`：返回小于等于 `x` 的最大整数。
- `math.ceil(x)`：返回大于等于 `x` 的最小整数。

---

### 3. 最值与小数分离

```lua
print(math.max(1, 2))      -- 输出: 2
print(math.min(4, 5))      -- 输出: 4
print(math.modf(1.2))      -- 输出: 1  0.2（整数部分, 小数部分）
```

> **注意**：
- `math.modf(x)` 会保留符号，例如 `math.modf(-1.2)` 返回 `-1, -0.2`。

---

### 4. 幂运算与随机数

```lua
print(math.pow(2, 5))       -- 输出: 32（2^5）
math.randomseed(os.time())  -- 设置随机种子（确保随机性）
print(math.random(100))     -- 输出: 0~100 的随机整数
print(math.random(100))     -- 输出: 另一个随机整数
```

> **规则**：
- `math.random(min, max)` 返回 `[min, max]` 范围内的整数。
- 若只传一个参数 `math.random(n)`，返回 `[1, n]` 的整数。

---

### 5. 开方运算

```lua
print(math.sqrt(4))  -- 输出: 2（平方根）
```

> **规则**：
- `math.sqrt(x)` 返回非负数的平方根。
- 若 `x` 为负数，会抛出错误（需使用 `math.sqrt(math.abs(x))` 处理）。

---

## 三、路径管理

### 1. 查看模块搜索路径

```lua
print(package.path)
```

> **关键特性**：
- `package.path` 是 Lua 模块的搜索路径列表，用分号 `;` 分隔。
- `?` 是占位符，表示模块名（如 `?.lua` 表示 `mylib.lua`）。

---

## 四、关键特性总结

| 模块      | 功能         | 常用函数/方法                                                |
| --------- | ------------ | ------------------------------------------------------------ |
| `os`      | 时间处理     | `os.time()`, `os.date("*t")`                                 |
| `math`    | 数学运算     | `math.abs`, `math.cos`, `math.floor`, `math.random`, `math.sqrt` |
| `package` | 模块路径管理 | `package.path`（查看模块搜索路径）                           |

---

## 五、常见注意事项

1. **时间戳精度**：
   
   - `os.time()` 返回的是整数秒，若需更高精度，需使用第三方库（如 `os.clock()` 仅测 CPU 时间）。
   
2. **随机数种子**：
   - 每次运行程序时调用 `math.randomseed(os.time())` 可确保随机性，否则 `math.random()` 会重复序列。

3. **路径修改**：
   ```lua
   package.path = package.path .. ";/my/custom/path/?.lua"
   ```

4. **错误处理**：
   - `math.sqrt(-1)` 会抛出错误，需提前检查输入合法性。
