[toc]

# Lua 函数

## 一、函数基础语法

### 1. 无参数无返回值

```lua
print("*********无参数无返回值*********")
function F1()
    print("F1函数")
end
F1()

F2 = function()
    print("F2函数")
end
F2()
```

> **关键特性**：
> - 使用 `function` 关键字声明函数
> - 函数可直接赋值给变量（函数是 Lua 的一等公民）
> - 调用函数使用 `()` 语法

---

## 二、函数参数

### 1. 有参数（无返回值）

```lua
print("*********有参数*********")
function F3(a)
    print(a)
end
F3(1)          -- 输出: 1
F3()           -- 输出: nil（未传参）
F3(2, 3, 4)    -- 输出: 2（多余参数会被忽略）
```

> **关键特性**：
> - 参数数量不固定，不足时默认为 `nil`
> - 多余参数会被忽略，**不会报错**
> - Lua 中函数参数是**弱类型**的

---

## 三、函数返回值

```lua
print("*********有返回值*********")
function F4(a)
    return a, true
end
temp, temp2 = F4("213")
print(temp)    -- 输出: 213
print(temp2)   -- 输出: true
```

> **关键特性**：
> - 可返回多个值
> - 接收变量不足时，**多余值被丢弃**
> - 接收变量多时，**不足部分为 nil**

---

## 四、函数类型

```lua
print("*********函数的类型*********")
F5 = function()
    print("123")
end
print(type(F5))  -- 输出: function
```

> **关键特性**：
> - 函数在 Lua 中是**一等公民**（first-class）
> - 函数可以赋值给变量、作为参数传递、作为返回值
> - 使用 `type()` 可验证函数类型

---

## 五、函数重载

```lua
print("*********函数重载*********")
-- Lua 不支持函数重载
-- 示例：无法定义两个同名函数
function F6()
    print("F6-1")
end
function F6()
    print("F6-2")
end
F6()  -- 输出: F6-2（后定义的函数会覆盖前一个）
```

> **关键特性**：
> - **不支持函数重载**（相同函数名会被覆盖）

---

## 六、变长参数（`...`）

```lua
print("*********变长参数*********")
function F7(...)
    local arg = {...}
    for i = 1, #arg do
        print(arg[i])
    end
end
F7(1, "123", true)
```

> **关键特性**：
> - 使用 `...` 表示变长参数
> - 变长参数需通过 `{...}` 转换为表进行处理
> - 支持任意类型的参数（包括 `nil`）

---

## 七、函数嵌套与闭包

### 1. 函数嵌套

```lua
print("*********函数嵌套*********")
function F8()
    return function()
        print("123")
    end
end
f9 = F8()()  -- 立即调用返回的函数
```

> **关键特性**：
> - 函数内部可定义函数（嵌套函数）
> - 返回的函数可立即调用（如 `F8()()`）

---

### 2. 闭包（Closure）

```lua
function F9(x)
    return function(y)
        return x + y
    end
end
f10 = F9(10)
print(f10(5))  -- 输出: 15
```

> **关键特性**：
> - 内部函数捕获外部函数的变量（`x` 的生命周期被延长）
> - 闭包可用于创建**工厂函数**或**延迟执行**逻辑
> - 外部函数返回后，内部函数仍可访问其作用域内的变量

---

## 八、关键特性总结

| 特性       | 说明                                                     |
| ---------- | -------------------------------------------------------- |
| 一等公民   | 函数可赋值给变量、作为参数传递、作为返回值               |
| 参数处理   | 参数不足 → `nil`；参数多余 → 忽略                        |
| 多返回值   | 支持多返回值，变量不足 → 丢弃；变量多 → 不足部分为 `nil` |
| 不支持重载 | 同名函数会被覆盖，需通过其他方式实现多态                 |
| 变长参数   | 使用 `...` 表示，需转换为表处理                          |
| 闭包       | 内部函数可捕获外部作用域变量，延长其生命周期             |
| 立即调用   | 函数可返回函数并立即调用（如 `F8()()`）                  |
