[toc]

# Lua 复杂数据类型：Table（表）

Lua 中所有的复杂数据类型都基于 `table`，它既是数组、字典的基础，也是类、模块等高级结构的核心。

---

## 一、基础数组

```lua
print("*********数组*********")
a = {1, 2, 3, 4, 5, 6, 7, 8}
print(a[1])  -- 输出: 1（索引从 1 开始）
```

> **关键特性**：
> - Lua 的数组索引从 `1` 开始（与 C#不同）
> - 使用 `{}` 创建数组
> - 支持任意类型元素

---

## 二、数组长度与 nil 的影响

```lua
a = {1, 2, nil, 4, true}
print(#a)  -- 输出: 2（# 运算符会忽略 nil）
```

> **重要规则**：
> - `#` 运算符会**忽略 `nil`**，只计算连续非 `nil` 元素
> - 若中间有 `nil`，`#` 会提前终止计算
> - **避免在数组中插入 `nil`**，否则会导致长度计算错误

---

## 三、数组遍历

```lua
print("*********数组遍历*********")
for i = 1, #a do
    print(a[i])
end
```

> **注意事项**：
> - 若数组中存在 `nil`，`#a` 会提前终止，导致遍历不完整
> - 示例中 `a = {1, 2, nil, 4, true}` 只会输出 `1` 和 `2`

---

## 四、二维数组

```lua
print("*********二维数组*********")
a = {
    {1, 2, 3},
    {4, 5, 6}
}
```

**遍历**

```lua
print("*********二维数组遍历*********")
for i = 1, #a do
    b = a[i]
    for j = 1, #b do
        print(b[j])
    end
end
```

> **关键特性**：
> - 使用嵌套 `table` 实现二维数组
> - 每个子表可以是不同长度（非矩形数组）

---

## 五、自定义索引

```lua
print("*********自定义索引*********")
aa = {
    [0] = 1,
    2, 3,
    [-1] = 4,
    5
}
print(aa[0])  -- 输出: 1
```

> **关键特性**：
> - `table` 支持任意值作为键（包括负数、`0`、字符串等）
> - 显式赋值的键会覆盖默认的连续索引
> - 默认索引仍从 `1` 开始

---



## 六、关键特性总结

| 特性           | 说明                                                 |
| -------------- | ---------------------------------------------------- |
| 基础类型       | 所有复杂数据类型均基于 `table`                       |
| 索引规则       | 默认索引从 `1` 开始，可自定义任意键                  |
| 长度运算符 `#` | 忽略 `nil`，仅计算连续非 `nil` 元素                  |
| 二维数组       | 使用嵌套 `table` 实现，子表可独立定义长度            |
| 自定义键       | 支持整数、字符串、负数等任意值作为键                 |
| 遍历限制       | 使用 `#` 遍历时，无法访问自定义键或 `nil` 位置的元素 |
