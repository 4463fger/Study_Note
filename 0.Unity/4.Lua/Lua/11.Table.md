[toc]

# Lua 复杂数据类型 Table 详解

## 一、字典

### 1. 字典的声明与访问

```lua
print("*********字典的声明*********")
a = {
    ["name"] = "4463",
    ["age"] = 14,
    ["1"] = 5
}
print(a["name"])    -- 输出: 4463
print(a.name)       -- 输出: 4463（等价于 a["name"]）
print(a.age)        -- 输出: 14
print(a["1"])       -- 输出: 5（数字键必须用方括号访问）
```

> **关键特性**：
> - 使用 `["key"]` 或 `.` 访问键值对
> - `.` 语法不能用于数字键（如 `a.1` 会报错）
> - 字典是 `table` 的自然扩展，支持任意类型键

---

### 2. 字典的增删改查

```lua
a["sex"] = false
print(a.sex)        -- 输出: false

a["sex"] = nil      -- 删除键值对
print(a.sex)        -- 输出: nil
```

> **关键特性**：
>
> - 使用 `t[key] = value` 添加或修改键值对
> - 使用 `t[key] = nil` 删除键值对

---

### 3. 字典的遍历

```lua
print("*********字典的遍历*********")
for key, value in pairs(a) do
    print(key, value)
end
```

> **其他遍历方式**：
```lua
for key in pairs(a) do
    print(key)              -- 打印所有键
    print(a[key])           -- 通过键获取值
end
```

> **关键特性**：
>
> - 使用 `pairs` 遍历所有键值对
> - `ipairs` 无法遍历字典（只适用于连续整数索引）

---

## 二、类和结构体的模拟

Lua 本身不支持面向对象编程，但可通过 `table` 模拟类和结构体。

### 1. 成员变量与函数

```lua
print("*********类和结构体*********")
Student = {
    age = 1,
    sex = 1,
    Up = function()
        print(Student.name .. " 我长大了")
    end,
    Learn = function(t)
        print(t.sex)
        print("Lua学习")
    end,
}
```

> **关键特性**：
> - 成员变量直接定义在表中
> - 成员函数通过嵌套函数实现
> - 函数第一个参数需显式传递调用者（如 `t`）

---

### 2. 动态添加成员

```lua
Student.name = "Lua"  -- 表外添加成员变量
function Student:Speak()
    print(self.name)
    print("Speak")
end
```

> **关键特性**：
> - 可在表外动态添加成员变量或方法
> - 使用 `:` 定义方法时，Lua 会自动将调用者作为 `self` 参数传入

---

### 3. 方法调用

```lua
Student.Learn(Student)   -- 显式传入调用者
Student:Learn()          -- 冒号语法自动传入调用者
Student:Speak()          -- 冒号语法调用方法
```

> **关键特性**：
> - `.` 调用方法需显式传递调用者
> - `:` 调用方法自动将调用者作为第一个参数（`self`）

---

## 三、表的公共操作函数

Lua 标准库提供了多个 `table` 操作函数，简化表的管理。

### 1. 插入与删除

```lua
t1 = {{age = 1, name = "123"}, {age = 2, name = "345"}}
t2 = {name = 1, age = 3}

print(#t1)            -- 输出: 2
table.insert(t1, t2)  -- 插入到末尾
print(#t1)            -- 输出: 3
print(t1[3].age)      -- 输出: 3

table.remove(t1, 3)   -- 删除第3个元素
```

> **关键特性**：
> - `table.insert(t, value)`：插入到末尾
> - `table.insert(t, index, value)`：插入到指定位置
> - `table.remove(t, index)`：删除指定位置的元素（默认删除末尾）

---

### 2. 排序

```lua
t3 = {5, 2, 1, 9}
table.sort(t3)  -- 升序排序
for _, v in pairs(t3) do
    print(v)    -- 输出: 1 2 5 9
end

table.sort(t3, function(a, b)
    return a > b  -- 降序排序
end)
```

> **关键特性**：
> - `table.sort(t)`：默认升序排序
> - `table.sort(t, comp)`：自定义排序规则（`comp` 返回布尔值）

---

### 3. 拼接

```lua
t4 = {"123", "456", "789"}
str = table.concat(t4, ";")  -- 使用分号拼接
print(str)                   -- 输出: 123;456;789
```

> **关键特性**：
> - `table.concat(t, sep)`：将表元素拼接为字符串
> - `sep` 是可选的分隔符（默认为空格）

---



## 四、关键特性总结

| 功能         | 说明                                                     |
| ------------ | -------------------------------------------------------- |
| 字典操作     | 使用 `["key"]` 或 `.` 访问键值对，支持任意类型键         |
| 类的模拟     | 通过 `table` 定义成员变量和方法，使用 `:` 自动传递调用者 |
| 表插入与删除 | `table.insert` 和 `table.remove` 管理表元素              |
| 排序         | `table.sort` 支持默认排序和自定义排序规则                |
| 拼接         | `table.concat` 将表元素拼接为字符串                      |
| 冒号语法     | `:` 调用方法时自动传递调用者作为 `self` 参数             |

---

## 五、常见注意事项

1. **字典遍历必须用 `pairs`**：
   
   ```lua
   t = {a = 1, b = 2}
   for k, v in ipairs(t) do print(k, v) end  -- 无输出（ipairs 不遍历字典）
   ```
   
2. **冒号语法 vs 点语法**：
   
   ```lua
   function T:Func()
       print(self)  -- self 是 T
   end
   T.Func(T)  -- 等价于 T:Func()
   ```
   
3. **排序规则陷阱**：
   ```lua
   table.sort(t, function(a, b) return a < b end)  -- 升序
   table.sort(t, function(a, b) return a > b end)  -- 降序
   ```

4. **表长度 `#` 的限制**：
   ```lua
   t = {1, 2, nil, 4}
   print(#t)  -- 输出: 2（忽略 nil）
   ```

> **提示**：`table` 是 Lua 最灵活的数据结构，合理使用可实现数组、字典、类等多种功能。
>
> 理解其行为和限制是高效开发的关键。