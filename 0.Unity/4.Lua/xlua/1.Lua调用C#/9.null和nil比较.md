[toc]

# Lua 中 `null` 与 `nil` 的比较

## 一、问题背景

在 Unity 中使用 Lua 调用 C# 组件时，经常会遇到判断组件是否为空的需求。例如：

```lua
local rig = obj:GetComponent(typeof(Rigidbody))
-- 这样写是错误的，作为演示
if rig == nil then
    rig = obj:AddComponent(typeof(Rigidbody))
end
```

但实际运行中可能出现如下问题：
- **Lua 的 `nil` 与 C# 的 `null` 无法直接比较**

---

## 二、`null` 与 `nil` 的本质区别

| 类型         | 定义                                                         |
| ------------ | ------------------------------------------------------------ |
| `null`       | C# 中表示引用类型的空对象（如 `Rigidbody` 为 `null`）。      |
| `nil`        | Lua 中表示没有值（或未定义）。                               |
| **关键区别** | `null` 是一个合法的 C# 对象（`System.Object` 的派生），`nil` 是 Lua 的无值状态。 |

---

## 三、解决方法

### 1. 使用``Equals(nil)``
```lua
if rig:Equals(nil) then
    rig = obj:AddComponent(typeof(Rigidbody))
end
```

### 2. Lua写全局IsNull函数

```csharp
function IsNull(obj)
    if obj == nil or obj:Equals(nil) then
        return true
    end
    return false
end
```

### 3. C#写一个判空的拓展方法

```csharp
if rig:IsNull() then
    rig = obj:AddComponent(typeof(Rigidbody))
end
```

---

## 八、参考代码结构（C# 对应）

```csharp
public class Code9 : MonoBehaviour
{
    public Rigidbody GetRigidbody()
    {
        return GetComponent<Rigidbody>();
    }
}
```
