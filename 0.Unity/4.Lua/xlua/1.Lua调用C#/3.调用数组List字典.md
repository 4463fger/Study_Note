[toc]

---

# Lua 调用 C# 数组、List 和 Dictionary

## 一、C# 数组调用

### 1. 访问 C# 数组
```lua
local obj = CS.LuaCallCsharp.Code4()
print(obj.array.Length) -- 输出: 5
print(obj.array[0])     -- 输出: 1
```

> **关键点**：
>
> - C# 数组索引从 `0` 开始。
> - `Length` 属性获取数组长度。
---

### 2. 遍历 C# 数组
```lua
for i = 0, obj.array.Length - 1 do
    print(obj.array[i])
end
```

> **注意**：
>
> - Lua 索引从 `1` 开始，但 C# 数组索引从 `0` 开始。
> - 遍历时需手动调整索引范围。
---

### 3. 在 Lua 中创建 C# 数组
```lua
-- 使用 Array.CreateInstance
local array2 = CS.System.Array.CreateInstance(typeof(CS.System.Int32), 5)
print(array2.Length) -- 输出: 5
```

> **规则**：
>
> - `Array.CreateInstance` 需指定类型和长度
---

## 二、List 调用

### 1. 操作 C# List
```lua
obj.List:Add(1)
obj.List:Add(2)
obj.List:Add(3)
print(obj.List.Count) -- 输出: 3
```

> **关键点**：
>
> - `Add` 方法用于添加元素。
> - `Count` 属性获取当前元素数量。
---

### 2. 遍历 C# List
```lua
for i = 0, obj.List.Count - 1 do
    print(obj.List[i])
end
```

> **注意**：
>
> 与数组类似，C# List 的索引从 `0` 开始。
---

### 3. 在 Lua 中创建 List
```lua
-- 方法1：旧版语法（兼容 XLua 早期版本）
local list2 = CS.System.Collections.Generic["List`1[System.String]"]()
list2:Add("123")

-- 方法2：新版语法（推荐）
local ListString = CS.System.Collections.Generic.List(CS.System.String)
local list3 = ListString()
list3:Add("6666")
print(list3[0]) -- 输出: 6666
```

> **优势**：
>
> - 新版语法更直观，与 C# 泛型语法一致。
> - 推荐统一使用 `List(类型)` 创建泛型 List。
---

## 三、Dictionary 调用

### 1. 操作 C# Dictionary
```lua
obj.Dict:Add(1, "123")
print(obj.Dict[1]) -- 输出: 123
```

> **规则**：
>
> - `Add(key, value)` 添加键值对。
> - 通过 `dict[key]` 直接访问值。
---

### 2. 遍历 C# Dictionary
```lua
for key, value in pairs(obj.Dict) do
    print(key, value)
end
```

> **注意**：
>
> - `pairs` 可遍历 Dictionary 的键值对。
> - C# Dictionary 的 `Key` 和 `Value` 会自动映射为 Lua 表的键值。
---

### 3. 在 Lua 中创建 Dictionary
```lua
-- 创建 Dictionary<String, Vector3>
local DictStringVector3 = CS.System.Collections.Generic.Dictionary(CS.System.String, CS.UnityEngine.Vector3)
local dict2 = DictStringVector3()
dict2:Add("123", CS.UnityEngine.Vector3.right)
```

> **关键限制**：
>
> - **不能直接通过 `dict[key]` 获取值**（XLua 的限制）
> - 必须使用 `get_Item(key)` 方法：
---

### 4. 删除与修改
```lua
-- 删除键值对
dict2:set_Item("123", nil) -- 或 dict2:Remove("123")

-- 修改值
dict2:set_Item("123", Vector3.up)
```

> **说明**：
>
> - `set_Item(key, value)` 用于修改或添加值。
> - `Remove(key)` 显式删除键值对。
---

## 四、参考代码结构（C# 对应）

```csharp
public class Code4
{
    public int[] array = new int[5] {1,2,3,4,5};
    public List<int> List = new List<int>();
    public Dictionary<int, string> Dict = new Dictionary<int, string>();
}
```
