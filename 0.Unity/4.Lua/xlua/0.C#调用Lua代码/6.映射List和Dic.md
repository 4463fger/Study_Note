[toc]

# C# 调用 Lua 中的 List 和 Dictionary

## 1. 核心概念

XLua 提供 `LuaTable.Global.Get<T>` 方法，可将 Lua 的 **列表（list）** 和 **字典（dict）** 映射为 C# 的 `List<T>` 和 `Dictionary<TKey, TValue>`。  
**特点**：

- **值拷贝,浅拷贝**：C# 中的操作不会影响 Lua 原始数据

---

## 2. 关键代码结构

### 2.1 获取 List

```csharp
// 指定类型
List<int> list = LuaManager.Instance.Global.Get<List<int>>("testList");
for (int i = 0; i < list.Count; i++)
{
    Debug.Log(list[i]);
    list[0] = 100; // ❌ 不会修改 Lua 中的原始列表
}

// 不指定类型（object 类型）
List<object> list2 = LuaManager.Instance.Global.Get<List<object>>("testList2");
for (int i = 0; i < list2.Count; i++)
{
    Debug.Log(list2[i]);
}
```

### 2.2 获取 Dictionary

```csharp
// 指定类型
// 值拷贝，浅拷贝，不会改变Lua中的内容
Dictionary<string, int> dic = LuaManager.Instance.Global.Get<Dictionary<string, int>>("testDic");
foreach (string key in dic.Keys)
{
    Debug.Log(key + "_" + dic[key]);
}

// 不指定类型（object 类型）
Dictionary<object, object> dic2 = LuaManager.Instance.Global.Get<Dictionary<object, object>>("testDic2");
foreach (object key in dic2.Keys)
{
    Debug.Log(key + "_" + dic2[key]);
}
```

---

## 4. 注意事项

1. **类型匹配**  
   
   - 数字列表建议用 `List<int>`  
   - 混合类型列表建议用 `List<object>`  
   - 字典键值对需与 Lua 表结构匹配
   
2. **不可变性**  
   ```csharp
   list[0] = 100; // ❌ 不会修改 Lua 中的原始值
   ```

3. **嵌套结构**  
   
   - 若 Lua 表嵌套了其他表，C# 中的 `List<Dictionary<...>>` 会共享引用
