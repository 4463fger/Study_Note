[toc]

# C# 调用 Lua 中 Class 的映射

## 1. 映射规则

- **字段名必须一致**：C# 类字段名需与 Lua 表中的键完全相同  
- **字段必须为 public**：XLua 通过反射访问字段  
- **值拷贝/浅拷贝**：C# 对象的修改不会影响 Lua 原始表  
- **支持嵌套映射**：C# 类中可包含其他 C# 类（需对应 Lua 表嵌套结构）

---

## 2. 关键代码结构

### 2.1 C# 类定义
```csharp
// 必须与 Lua 表字段名一致，且为 public
public class CallLuaClass
{
    public int internalInt;
    public bool internalBool;
    public Action func;
    public CallLuaInClass internalClass;
}

public class CallLuaInClass
{
    public int classInt;
}
```

### 2.2 获取 Lua 表并映射
```csharp
LuaManager.Instance.OnInit();
LuaManager.Instance.DoLuaFile("Main");

// 将 Lua 表映射为 C# 对象
CallLuaClass callLuaClass = LuaManager.Instance.Global.Get<CallLuaClass>("testClass");

// 访问字段
Debug.Log(callLuaClass.internalInt);
Debug.Log(callLuaClass.internalBool);

// 调用函数字段
callLuaClass.func();

// 访问嵌套类
Debug.Log(callLuaClass.internalClass.classInt);
```

---

## 4. 注意事项

| 规则             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| **字段名一致性** | `CSharpCallLuaClass.internalInt` 必须与 `Lua.testClass.internalInt` 字段名完全一致 |
| **字段可见性**   | 所有字段必须为 `public`，否则 XLua 无法访问                  |
| **类型匹配**     | 基础类型（int/bool）需严格匹配，复杂类型需嵌套映射           |
| **函数映射**     | Lua 函数字段需映射为 `Action`/`Func` 或 `LuaFunction` 类型   |
