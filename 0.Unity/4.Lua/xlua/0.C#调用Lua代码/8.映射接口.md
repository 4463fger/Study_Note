[toc]

# C# 调用 Lua 接口映射

## 1.接口映射规则

- **接口成员限制**：只能包含属性和方法（无字段）  
- **引用拷贝特性**：修改接口属性会直接影响 Lua 原始表（与类映射不同）  
- **类型约束**：需添加 `[CSharpCallLua]` 特性标记  

---

## 2. 关键代码结构

### 2.1 接口定义
```csharp
// 必须添加 [CSharpCallLua] 特性
[CSharpCallLua]
public interface ICsharpCallInterface
{
    int internalInt { get; set; } // 属性
    int internalBool { get; set; } // 属性
    Action func { get; set; } // 函数属性
}
```

### 2.2 获取接口实例
```csharp
LuaManager.Instance.OnInit();
LuaManager.Instance.DoLuaFile("Main");

// 将 Lua 表映射为接口
ICsharpCallInterface call = LuaManager.Instance.Global.Get<ICsharpCallInterface>("testClass2");

// 访问属性
Debug.Log(call.internalInt);
Debug.Log(call.internalBool);

// 调用函数属性
call.func();

// 修改属性（影响 Lua 原始表）
call.internalInt = 100;

// 验证修改生效
ICsharpCallInterface call2 = LuaManager.Instance.Global.Get<ICsharpCallInterface>("testClass2");
Debug.Log(call2.internalInt); // 输出 100
```

---

## 4. 注意事项

| 规则             | 说明                                     |
| ---------------- | ---------------------------------------- |
| **接口成员限制** | 只能定义属性和方法，不能有字段或构造函数 |
| **引用拷贝特性** | 修改接口属性会直接修改 Lua 表中的值      |
| **类型匹配**     | 属性类型需与 Lua 表字段类型严格匹配      |
| **函数属性**     | Lua 函数需映射为 `Action`/`Func` 类型    |
