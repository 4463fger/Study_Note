[toc]

# Lua文件加载重定向

## 1. 核心概念
**AddLoader** 是 `XLua`提供的路径重定向接口，允许我们自定义 Lua 脚本的加载规则。

通过重写加载器，可以自定义控制 Lua 文件的查找路径和加载方式。

---

## 2. 实现步骤

```csharp
// 创建 Lua 环境
LuaEnv env = new();
// 注册自定义加载器（核心）
env.AddLoader(MyCustomLoader); 
// 加载 Lua 脚本
env.DoString("require('Main')"); 
```

---

## 3. 关键方法解析

```csharp
// 自动执行
private byte[] MyCustomLoader(ref string filePath)
{
    // 构建完整文件路径
    string path = Application.dataPath + "/Lua/" + filePath + ".lua";
    Debug.Log(path);

    // 读取文件内容（返回字节流）
    if (File.Exists(path))
    {
        return File.ReadAllBytes(path);
    }
    else
    {
        Debug.Log("MyCustomLoader重定向失败，文件名: " + path);
    }
    return null;
}
```

| 参数                  | 作用                                                   |
| --------------------- | ------------------------------------------------------ |
| `ref string filePath` | `require` 中传入的文件名（不带后缀）                   |
| 返回值                | 返回 Lua 脚本的字节流（`byte[]`），若找不到返回 `null` |
