[toc]

# 泛型类替换

> 场景：C# 端有泛型类 `HotfixTest2<T>`，需要针对**不同的具体类型参数**分别打补丁。

---

## 一、C# 原始代码

```csharp
[Hotfix]
public class HotfixTest2<T>
{
    public void Test(T t)
    {
        Debug.Log("C# 原逻辑：" + t);
    }
}
```

---

## 二、Lua 热补丁代码

```lua
print("**********泛型类的替换**********")

-- 1. 给 HotfixTest2<string> 打补丁
xlua.hotfix(CS.Study.HotfixTest2(CS.System.String), {
    Test = function(self, str)
        print("Lua中打的补丁" .. str)
    end
})

-- 2. 给 HotfixTest2<int> 打补丁
xlua.hotfix(CS.Study.HotfixTest2(CS.System.Int32), {
    Test = function(self, num)
        print("Lua中打的补丁" .. num)
    end
})
```

---

## 三、 xLua 泛型补丁规则

| 语法                                     | 说明                                                 |
| ---------------------------------------- | ---------------------------------------------------- |
| `CS.Study.HotfixTest2(CS.System.String)` | 获取**已实例化**的泛型类型 `HotfixTest2<string>`     |
| **必须**指定具体类型参数                 | 无法对开放泛型 `HotfixTest2<>` 打补丁                |
| 每种实例化类型**单独一份补丁**           | `HotfixTest2<int>` 与 `HotfixTest2<string>` 互不影响 |

---

## 四、常见类型简写

| 常用类型  | 简写形式                 |
| --------- | ------------------------ |
| `int`     | `CS.System.Int32`        |
| `float`   | `CS.System.Single`       |
| `bool`    | `CS.System.Boolean`      |
| `string`  | `CS.System.String`       |
| `Vector3` | `CS.UnityEngine.Vector3` |

---

## 五、限制与注意

1. **只能替换实例方法**  
   泛型静态方法/字段暂不支持热补丁。

2. **泛型方法（在普通类里）**  
   例如 `void Foo<T>(T t)` 目前**无法**直接打补丁；需改走**方法封装**或**拆成非泛型重载**。

3. **注入顺序**  
   若新增/修改了泛型类，仍需重新  
   `Generate Code` → `Hotfix Inject In Editor`。
